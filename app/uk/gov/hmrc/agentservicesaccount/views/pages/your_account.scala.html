@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.agentservicesaccount.auth.AgentInfo
@import uk.gov.hmrc.agentservicesaccount.config.AppConfig
@import uk.gov.hmrc.agentservicesaccount.controllers.routes
@import uk.gov.hmrc.agentmtdidentifiers.model.GroupSummary
@import uk.gov.hmrc.agentservicesaccount.views.html.main

@this(
    main: main, h1: h1, h2: h2, h3: h3, p: p, a: a, ul_html: ul_html, span: span,
)

@(
    info: Option[AgentInfo] = None,
    groups: Option[Seq[GroupSummary]] = None,
    optedIn: Boolean = true
)(implicit msgs: Messages, request: Request[_], appConfig: AppConfig)

@main(pageTitle = msgs("your.account.h1"), analyticsAdditionalJs = None, fullWidth = true, isAdmin = false) {

    <div class="govuk-grid-column-full">
@* the govuk-grid-column-full class has a padding left that
    aligns this h1 with rest of page*@
        @h1("your.account.h1")
    </div>

    @if(info.isDefined){
        <div class="govuk-grid-column-two-thirds" id="user-details">
            @h2("your.account.h3.name", size = "s")
            @p(info.get.name.map(n => n.name.getOrElse("") + " " + n.lastName.getOrElse("")).getOrElse("" ))
            @h2("your.account.h3.email", size = "s")
            @p(info.get.email.getOrElse(""))
            @h2("your.account.h3.role", size = "s")
            @p("your.account.p.role")
        </div>

        @if(optedIn){

            <div class="govuk-grid-column-one-third" id="user-groups">
            @* Missing content if not opted in your.account.your.groups.off.p *@
            @h2("your.account.your.groups.h2")
            <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
            @if(groups.isEmpty || groups.get.isEmpty) {
                @p("your.account.your.groups.p")
            } else {
                @ul_html(items = groups.get.map(grp =>
                    Html(
                        a(
                            key = grp.groupName,
                            href = s"${appConfig.agentPermissionsFrontendAssistantViewGroupClientsUrl}/${grp.groupId}").toString
                    )
                )
                )
            }

            @h2("your.account.unassigned-clients.h2")
            <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
            @a(key= "your.account.unassigned-clients",
            href= s"${appConfig.agentPermissionsFrontendAssistantViewUnassignedClientsUrl}")
        </div>
        }
    }

    <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

    <div class="govuk-grid-column-full" id="bottom-panel">
        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
        @h2("your.account.your.admins.h2")
        @a("your.account.your.admins.a", href = routes.AgentServicesController.administrators.url)

        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

        @h2("manage.account.contact-details.heading")
        @p(html = Some(
            a(href = routes.AgentServicesController.accountDetails.url,
                key = "manage.account.contact-details.view"
            )))
    </div>
}
