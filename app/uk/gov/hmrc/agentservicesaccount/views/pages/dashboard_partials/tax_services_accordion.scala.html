@*
 * Copyright 2024 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.agentservicesaccount.config.AppConfig
@import uk.gov.hmrc.govukfrontend.views.Aliases.{Accordion, HtmlContent, Text, WarningText}
@import uk.gov.hmrc.govukfrontend.views.html.components.{GovukAccordion, GovukWarningText}
@import uk.gov.hmrc.govukfrontend.views.viewmodels.accordion.Section

@import scala.collection.mutable.ListBuffer

@this(
        p: p, h2: h2, h4: h4, a: a, span: span, ul_html: ul_html,
        govukWarningText: GovukWarningText,
        govukAccordion: GovukAccordion,
)

@()(implicit msgs: Messages, request: RequestHeader, appConfig: AppConfig)

@itsaAccordionItemLegacy = {
    @h4("asa.sectionITSA.col1.h4")
    @p(html = Some(Html(msgs("asa.sectionITSA.legacy.col1.p1", appConfig.agentMappingUrl))))
    @p(html = Some(Html(msgs("asa.sectionITSA.legacy.col1.p2", appConfig.agentClientRelationshipsFrontendInvitationsUrl))))
    @h4("asa.sectionITSA.legacy.col2.h4")
    @p(html = Some(
        a(href= "https://www.gov.uk/guidance/sign-up-your-client-for-making-tax-digital-for-income-tax",
          key =  "asa.sectionITSA.legacy.col2.p1",
          openInNewWindow = true
        )
    ))
    @p(html = Some(Html(msgs(
        "asa.sectionITSA.legacy.col2.p2", "https://www.gov.uk/guidance/using-making-tax-digital-for-income-tax"
    ))))
    @p(html = Some(Html(msgs("asa.sectionITSA.legacy.col2.p3", appConfig.incomeTaxSubscriptionSignupClientUrl))))
    @h4("asa.sectionITSA.legacy.col3.h4")
    @p(html = Some(
        a(href= appConfig.incomeTaxSubscriptionAgentFrontendUrl,
          key =  "asa.sectionITSA.legacy.col3.p",
          openInNewWindow = false
        )
    ))
}

@itsaAccordionItem = {
    @h4("asa.sectionITSA.col1.h4")
    @p(html = Some(Html(msgs("asa.sectionITSA.col1.p1", appConfig.govUkItsaAsAnAgent))))
    @h4("asa.sectionITSA.col2.h4")
    @ul_html(Seq(
        a(href = appConfig.agentMappingUrl, key = "asa.sectionITSA.col2.p1"),
        a(href = appConfig.agentClientRelationshipsFrontendInvitationsUrl, key = "asa.sectionITSA.col2.p2")
    ))
    @h4("asa.sectionITSA.col3.h4")
    @p(html = Some(Html(msgs("asa.sectionITSA.col3.p1", appConfig.incomeTaxSubscriptionSignupClientUrl))))
    @h4("asa.sectionITSA.col4.h4")
    @p(html = Some(Html(msgs("asa.sectionITSA.col4.p1", appConfig.incomeTaxSubscriptionAgentFrontendUrl))))
}

@mtdForVatAccordionItem = {
    @h4("asa.section1.col1.h3")
    <p>
    @a("asa.section1.col1.p", href =  appConfig.agentClientRelationshipsFrontendInvitationsUrl)
    </p>

    @h4("asa.section1.col2.h3")
    @ul_html(
        items = Seq[Html](
            a(href = appConfig.vrsUrl,
                key = "asa.section1.col2.link1",
                openInNewWindow = true
            ),
            a(href = appConfig.vatUrl,
                key = "asa.section1.col2.link2",
                openInNewWindow = true
            )
        ),
        classes = Some("govuk-list--bullet")
    )
}

@payeIncomeRecordAccordionItem = {
@p("asa.paye-section.text")
@p(html = Some(a(href = appConfig.taxHistoryFrontendUrl, key = "asa.paye-section.link")))
}

@trustsAccordionItem = {
@h4("asa.trusts-section.col1.h3")
@p(msgs("asa.trusts-section.col1.register-trust.p", appConfig.agentClientRelationshipsFrontendInvitationsUrl))
@p("asa.trusts-section.col1.register-estate.p")
@h4("asa.trusts-section.col2.h3")
@p(html = Some(Html(a(href = "https://www.gov.uk/guidance/manage-your-trusts-registration-service",
    key = "asa.trusts-section.col2.register-trust-link.text") + ".")))
}

@capitalGainsAccordionItem = {

@h4("asa.section3.col1.h3")
@p(html = Some(Html(
    span("asa.section3.col1.text1") + "" +
            span(msgs("asa.section3.col1.link1",
                msgs("asa.section3.col1.link1.href"))))
))

@p(html = Some(
    Html(
        span("asa.section3.col1.text2") + " " +
                span(key = msgs("asa.section3.col1.link2",
                    msgs("asa.section3.col1.link2.href"))))
))
@h4("asa.section3.col2.h3")
@p(key = msgs("asa.section3.col2.link1",
    msgs("asa.section3.col2.link1.href")))
}

@plasticPackagingItem = {

@h4("asa.ppt.col1.h3")
@p(html = Some(
    Html(
        span("asa.ppt.col1.text1") + "" +
                span(msgs("asa.ppt.col1.link1",
                    msgs("asa.ppt.col1.link1.href")))
    )
))

@p(html = Some(
    Html(
        span("asa.ppt.col1.text2") + " " +
                span(key = msgs("asa.ppt.col1.link2", appConfig.agentClientRelationshipsFrontendInvitationsUrl)))
))

@h4("asa.ppt.col2.h3")
@p(msgs("asa.ppt.col2.link1", msgs("asa.ppt.col2.link1.href")))


}
    @CounrtyByCountryAccordionItem = {

            @h4("asa.section3.col1.h3")
            @p(msgs("asa.cbc-section.col1.link1.p", appConfig.agentClientRelationshipsFrontendInvitationsUrl))

            @h4("asa.cbc.col1.h2")
            @p(html = Some(a(href = "https://www.tax.service.gov.uk/send-a-country-by-country-report",
                key = "asa.cbc-section.col1.link2.p")))
        }

@pillar2Item = {
    @h4("asa.pillar2.col1.h3")
    @p(html = Some(
        Html(
            span("asa.pillar2.col1.text1") + "" +
                    span(msgs("asa.pillar2.col1.link1",
                        appConfig.pillar2GuidanceUrl))
        )
    ))

    @p(html = Some(
        Html(
            span("asa.pillar2.col1.text2") + " " +
                    span(key = msgs("asa.pillar2.col1.link2", appConfig.agentClientRelationshipsFrontendInvitationsUrl)))
    ))

    @h4("asa.pillar2.col2.h3")
    @p(msgs("asa.pillar2.col2.link1", appConfig.pillar2StartUrl))
}

@otherTaxesItem = {
@govukWarningText(WarningText(content = HtmlContent(span("asa.other.p1"))))
}

@accordionItems = @{
    val items = ListBuffer[Section]()
    items.append(
        Section(
            headingContent = Text(msgs("asa.sectionITSA.h2")),
            content = HtmlContent(itsaAccordionItem)
        )
    )
    items.append(
        Section(
            headingContent = Text(msgs("asa.section1.h2")),
            content = HtmlContent(mtdForVatAccordionItem)
        )
    )
    items.append(
        Section(
            headingContent = Text(msgs("asa.paye-section.h2")),
            content = HtmlContent(payeIncomeRecordAccordionItem)
        )
    )
    items.append(
        Section(
            headingContent = Text(msgs("asa.trusts-section.h2")),
            content = HtmlContent(trustsAccordionItem)
        )
    )
    items.append(
        Section(
            headingContent = Text(msgs("asa.section3.col1.h2")),
            content = HtmlContent(capitalGainsAccordionItem)
        )
    )

    if(appConfig.enableCbc) {
        items.append(
            Section(
            headingContent = Text(msgs("asa.cbc.col1.h3")),
            content = HtmlContent(CounrtyByCountryAccordionItem)
            )
        )
    }
    items.append(
        Section(
            headingContent = Text(msgs("asa.ppt.col1.h2")),
            content = HtmlContent(plasticPackagingItem)
        )
    )

    if(appConfig.enablePillar2) {
        items.append(
            Section(
                headingContent = Text(msgs("asa.pillar2.col1.h2")),
                content = HtmlContent(pillar2Item)
            )
        )
    }

    items.append(
        Section(
            headingContent = Text(msgs("asa.other.heading")),
            content = HtmlContent(otherTaxesItem)
        )
    )
    items
}

@govukAccordion(
    Accordion(
        id = "tax-services-accordion",
        headingLevel = 3,
        items = accordionItems.toSeq,
        hideSection = Some(msgs("accordion.hideSection")),
        hideAllSections = Some(msgs("accordion.hideAllSections")),
        hideSectionAriaLabel = Some(msgs("accordion.hideSectionAria")),
        showSection = Some(msgs("accordion.showSection")),
        showAllSections = Some(msgs("accordion.showAllSections")),
        showSectionAriaLabel = Some(msgs("accordion.showSectionAria"))
    )
)
