@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.agentservicesaccount.config.AppConfig
@import uk.gov.hmrc.agentservicesaccount.views.html.components._
@import uk.gov.hmrc.agentservicesaccount.views.html.main
@import uk.gov.hmrc.govukfrontend.views.Aliases.Text
@import uk.gov.hmrc.govukfrontend.views.html.components.{GovukAccordion, GovukPanel}
@import uk.gov.hmrc.govukfrontend.views.viewmodels.accordion.{Accordion, Section}
@import uk.gov.hmrc.govukfrontend.views.viewmodels.content.HtmlContent
@import uk.gov.hmrc.govukfrontend.views.viewmodels.panel.Panel
@import uk.gov.hmrc.hmrcfrontend.views.html.helpers.HmrcReportTechnicalIssueHelper
@import uk.gov.hmrc.govukfrontend.views.html.components.GovukWarningText
@import uk.gov.hmrc.govukfrontend.views.viewmodels.warningtext.WarningText


@import scala.collection.mutable.ListBuffer

@this(
    mainTemplate: main,
    p: p,
    h2: h2,
    h3: h3,
    ul: ul,
    a: a,
    span: span,
    govukWarningText: GovukWarningText,
    govukPanel: GovukPanel,
    govukAccordion: GovukAccordion,
    hmrcReportTechnicalIssueHelper: HmrcReportTechnicalIssueHelper,
    secondaryNav: secondary_nav
)
@(
    arn: String,
        isIrvAllowed: Boolean,
    customDimension: String,
    isAdmin: Boolean = false,
    isSuspendedForVat: Boolean
)(implicit request: Request[_], msgs: Messages, appConfig: AppConfig)

@itsaAccordionItem = {
    @h3("agent.services.account.sectionITSA.col1.h3")
    @p(html = Some(Html(msgs("agent.services.account.sectionITSA.col1.p",
        appConfig.agentMappingUrl,
        appConfig.agentInvitationsFrontendClientTypeUrl))))
    @p(html = Some(Html(msgs("agent.services.account.sectionITSA.col1.link"))))
    @h3("agent.services.account.sectionITSA.col2.h3")

    @p(html = Some(Html(
            a(href = appConfig.incomeTaxSubscriptionAgentFrontendUrl, key = "agent.services.account.sectionITSA.col2.link1.text") + "")
        )
    )
    @p(html = Some(Html(
        a(href = "https://www.gov.uk/guidance/follow-the-rules-for-making-tax-digital-for-income-tax#who-can-follow-the-rules",
            key = "agent.services.account.sectionITSA.col2.link2.text",
            target= Some("_blank"),
            rel = Some("noreferrer noopener")
        ) + "")
        )
    )
}

@mtdForVatAccordionItem = {
    @if(isSuspendedForVat) {
        @h3("agent.services.account.section1.suspended.h3")
        @p("agent.services.account.section1.suspended.p1")
        @p("agent.services.account.section1.suspended.p2")
    } else {
        @h3("agent.services.account.section1.col1.h3")
        @p(
            html = Some(Html(
                msgs("agent.services.account.section1.col1.p",
                    appConfig.agentMappingUrl,
                    appConfig.agentInvitationsFrontendClientTypeUrl)))
        )
        @p(html=Some(Html(msgs("agent.services.account.section1.col1.link"))))

        @h3("agent.services.account.section1.col2.h3")
        @p(html = Some(Html(
            a(href = appConfig.vatUrl,
                key = "agent.services.account.section1.col2.link",
                target= Some("_blank"),
                rel = Some("noreferrer noopener")
            ) + "")
        )
        )

    }
}

@payeIncomeRecordAccordionItem = {
    @p("agent.services.account.paye-section.text")
    @p(html = Some(Html(a(href = appConfig.taxHistoryFrontendUrl, key = "agent.services.account.paye-section.link") + "")))
}

@trustsAccordionItem = {
    @h3("agent.services.account.trusts-section.col1.h3")
    @p(msgs("agent.services.account.trusts-section.col1.register-trust.p", appConfig.agentInvitationsFrontendClientTypeUrl))
    @p("agent.services.account.trusts-section.col1.register-estate.p")
    @h3("agent.services.account.trusts-section.col2.h3")
    @p(html=Some(Html(a(href = "https://www.gov.uk/guidance/manage-your-trusts-registration-service",
            key = "agent.services.account.trusts-section.col2.register-trust-link.text") +  ".")))
}

@capitalGainsAccordionItem = {

    @h3("agent.services.account.section3.col1.h3")
    @p(html = Some(Html(
        span("agent.services.account.section3.col1.text1") + "" +
        span(msgs("agent.services.account.section3.col1.link1",
            msgs("agent.services.account.section3.col1.link1.href"))))
    ))

    @p(html = Some(
        Html(
            span("agent.services.account.section3.col1.text2") + " " +
                    span(key=msgs("agent.services.account.section3.col1.link2",
                        msgs("agent.services.account.section3.col1.link2.href"))))
    ))
    @h3("agent.services.account.section3.col2.h3")
    @p(key = msgs("agent.services.account.section3.col2.link1",
        msgs("agent.services.account.section3.col2.link1.href")))
}

@plasticPackagingItem = {

    @h3("agent.services.account.ppt.col1.h3")
    @p(html = Some(
        Html(
            span("agent.services.account.ppt.col1.text1") + "" +
                    span(msgs("agent.services.account.ppt.col1.link1",
                msgs("agent.services.account.ppt.col1.link1.href")))
        )
    ))

    @p(html = Some(
        Html(
            span("agent.services.account.ppt.col1.text2") + " " +
                    span(key = msgs("agent.services.account.ppt.col1.link2", appConfig.agentInvitationsFrontendUrl)))
    ))

    @h3("agent.services.account.ppt.col2.h3")
    @p(msgs("agent.services.account.ppt.col2.link1", msgs("agent.services.account.ppt.col2.link1.href")))


}
@otherTaxesItem = {
    @govukWarningText(
        WarningText(
            content = HtmlContent(
                span("asa.other.p1")
            )
        )
    )
}

@accordionItems = @{
    val items = ListBuffer[Section]()
    if(appConfig.ITSAAccordionEnabled) {
        items.append(
            Section(
                headingContent = Text(msgs("agent.services.account.sectionITSA.h2")),
                content = HtmlContent(itsaAccordionItem)
            )
        )
    }
    items.append(
        Section(
            headingContent = Text(msgs("agent.services.account.section1.h2")),
            content = HtmlContent(mtdForVatAccordionItem)
        )
    )
    if(isIrvAllowed) {
        items.append(
            Section(
                headingContent = Text(msgs("agent.services.account.paye-section.h2")),
                content = HtmlContent(payeIncomeRecordAccordionItem)
            )
        )
    }
    items.append(
        Section(
            headingContent = Text(msgs("agent.services.account.trusts-section.h2")),
            content = HtmlContent(trustsAccordionItem)
        )
    )
    items.append(
        Section(
            headingContent = Text(msgs("agent.services.account.section3.col1.h2")),
            content = HtmlContent(capitalGainsAccordionItem)
        )
    )
    if (appConfig.enablePpt) {
        items.append(
            Section(
                headingContent = Text(msgs("agent.services.account.ppt.col1.h2")),
                content = HtmlContent(plasticPackagingItem)
            )
        )
    }
    items.append(
        Section(
            headingContent = Text(msgs("asa.other.heading")),
            content = HtmlContent(otherTaxesItem)
        )
    )
    items
}

@mainTemplate(pageTitle = Some(msgs("agent.services.account.heading")), beforeContentBlock = Some(secondaryNav(isAdmin))) {

    @govukPanel(
        Panel(
            title = Text(msgs("agent.services.account.welcome")),
            content = HtmlContent(msgs("agent.accountNumber", arn)),
            classes = "blue-panel"
        )
    )

    @h2("agent.services.account.section4.h2")

    @p("agent.services.account.client-authorisations.p")

    @ul(items = Seq[Html](
        a(href = appConfig.agentInvitationsFrontendUrl, key="agent.services.account.section4.col1.link"),
        a(href = appConfig.agentInvitationsTrackUrl, key="agent.services.account.section4.col2.link1"),
        a(href = appConfig.agentMappingUrl, key="agent.services.account.section4.col2.link2"),
        a(href = appConfig.agentInvitationsCancelAuthUrl, key="agent.services.account.section4.col2.link3"),
    ))

    <hr class="govuk-section-break hr-thick govuk-!-margin-bottom-6">

    @h2("agent.services.account.tax-services")

    @govukAccordion(
        Accordion(
            id = "accordion-default",
            items = accordionItems
        )
    )

    <hr class="govuk-section-break hr-thick govuk-!-margin-bottom-6">

    @h2("agent.services.account.help.h2")
    @p(html = Some(Html(
        a(href = "/agent-services-account/help-and-guidance",
            key = "agent.services.account.help.link",
        ) + "")
    )
    )

    @hmrcReportTechnicalIssueHelper()

}