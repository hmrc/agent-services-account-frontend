@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.agentmtdidentifiers.model.Arn
@import uk.gov.hmrc.agentservicesaccount.config.ExternalUrls
@import play.api.Configuration

@(arn: Arn, isAdmin: Boolean, agencyNameOpt: Option[String], isWhitelisted: Boolean, customDimension: String)(implicit messages: Messages, request: Request[_], externalUrls: ExternalUrls, configuration: Configuration)

@analyticsAdditionalJs = {

    @featureSwitch("features.showAgentInvitationsLink", isWhitelisted) {
        ga('send', 'event', {
            'eventCategory': '@Messages("agent.services.account.additional.links.agent-afi.ga.link-view")',
            'eventAction': '@Messages("agent.services.account.additional.links.agent-afi.ga.manage-clients")',
            'eventLabel': '@Messages("agent.services.account.additional.links.agent-afi.ga.request-auth")'
        });
    }
    @featureSwitch("features.showAgentAfiLink", isWhitelisted) {
        ga('send', 'event', {
            'eventCategory': '@Messages("agent.services.account.additional.links.agent-afi.ga.link-view")',
            'eventAction': '@Messages("agent.services.account.additional.links.agent-afi.ga.services-you-need")',
            'eventLabel': '@Messages("agent.services.account.additional.links.agent-afi.ga.view-income-record")'
        });
    }

    ga('send', 'pageview', { '@customDimension': '@if(isWhitelisted) {Whitelisted} else {Non-Whitelisted}' });

}


@agencyName(agencyNameOpt: Option[String]) = {
    @agencyNameOpt.map { name =>
        <span id="agency-name">@name</span>
    }
}

@featureSwitch(featureName: String, toggle: Boolean = true)(content: Html) = {
    @if(toggle && configuration.getBoolean(featureName).getOrElse(false)) { @content }
}


@uk.gov.hmrc.agentservicesaccount.views.html.main_template(title = Messages("agent.services.account.heading"), mainClass = Some("full-width"), analyticsAdditionalJs = Some(analyticsAdditionalJs)) {

    <h1 class="heading-xlarge">@agencyName(agencyNameOpt)
        <span class="pre-heading">@Messages("agent.accountNumber", arn.value)</span>
    </h1>


@if(configuration.getBoolean("features.showAgentAfiLink").getOrElse(false) || configuration.getBoolean("features.showAgentInvitationsLink").getOrElse(false) || configuration.getBoolean("features.showAgentMappingLink").getOrElse(false)){
    <h2 class="heading-medium divider--bottom">@Messages("agent.services.account.h2.your-clients")</h2>
}
    <div class="grid-row">

        <div class="column-one-half">
            @featureSwitch("features.showAdditionalServicesSection") {
                @featureSwitch("features.showAgentAfiLink", isWhitelisted) {
                    <div class="card">
                        <div class="card-body non-active">
                            <h3 class="heading-small card-heading">
                                @Messages("agent.services.account.h3.agent-services")
                            </h3>
                            <p>@Messages("agent.services.account.p.agent-services")</p>
                        </div>
                        <div class="card-action">
                            <p>@Html(Messages("agent.services.account.additional.links.agent-afi.body2", externalUrls.agentAfiUrl, "agentAfiLinkId"))</p>
                        </div>
                    </div>
                        }
                    }
                </div>

        <div class="column-one-half">

            @if(configuration.getBoolean("features.showAgentInvitationsLink").getOrElse(false) || configuration.getBoolean("features.showAgentInvitationsTrackLink").getOrElse(false) || configuration.getBoolean("features.showAgentMappingLink").getOrElse(false) || configuration.getBoolean("features.showAgentLedDeAuthLink").getOrElse(false)){

                <div class="card">
                    <div class="card-body non-active">
                        <h3 class="heading-small card-heading">
                            @Messages("agent.services.account.h3.client-authorisations")
                        </h3>
                        <p>@Messages("agent.services.account.p.client-authorisations")</p>
                    </div>
                    <div class="card-action">
                        <ul>
                            @featureSwitch("features.showAgentInvitationsLink") {
                                <li>@Html(Messages("agent.invitations.links.start", externalUrls.agentInvitationsUrl, "agentInvitationsLinkId"))</li>
                            }

                            @featureSwitch("features.showAgentInvitationsTrackLink") {
                                <li>@Html(Messages("agent.invitations.links.track", externalUrls.agentInvitationsTrackUrl, "agentInvitationsTrackLinkId"))</li>

                            }

                            @featureSwitch("features.showAgentMappingLink") {
                                <li>@Html(Messages("agent.services.account.additional.links.mapping.body2", externalUrls.agentMappingUrl, "agentMappingLinkId"))</li>
                            }

                            @featureSwitch("features.showAgentLedDeAuthLink") {
                            <li>@Html(Messages("agent.invitations.links.cancel-auth", externalUrls.agentCancelAuthUrl, "agentCancelAuthLinkId"))</li>
                            }

                        </ul>
                    </div>
                </div>
            }
        </div>
    </div>

    @featureSwitch("features.showUserManagement") {
        @if(isAdmin) {

            <h2 class="heading-medium divider--bottom">@agencyName(agencyNameOpt)@Messages("agent.services.sccount.h2.client")</h2>

            <div class="grid-row">
                <div class="column-one-half">
                    <div class="card">
                        <div class="card-body non-active">
                            <h3 class="heading-small card-heading">
                                @Messages("agent.services.account.h3.manage")
                            </h3>
                            <p>@Messages("agent.services.account.p.manage")</p>
                        </div>
                        <div class="card-action">
                            <ul>
                                @featureSwitch("features.showAddUserLink") { <li>@Html(Messages("agent.addNewUser.links.start", externalUrls.addUserUrl, "addUserLinkId"))</li> }
                                @featureSwitch("features.showManageUsersLink") { <li>@Html(Messages("agent.manageYourUsers.links.start", externalUrls.manageUsersUrl, "manageYourUsersLinkId"))</li> }
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="column-one-half"></div>
            </div>

        }
    }
}
